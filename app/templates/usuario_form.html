{% extends "base.html" %}

{% block content %}

<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-xl mx-auto px-4">

        <!-- Cabe√ßalho -->
        <div class="mb-6">
            <a href="{{ url_for('main.gerenciar_usuarios') }}"
                class="text-sm text-blue-600 hover:underline mb-2 inline-block">‚Üê Voltar para lista de usu√°rios</a>
            {% if usuario %}
            <h1 class="text-2xl font-bold text-gray-900">Editar Usu√°rio</h1>
            <p class="text-sm text-gray-500 mt-1">Altere os dados do usu√°rio</p>
            {% else %}
            <h1 class="text-2xl font-bold text-gray-900">Novo Usu√°rio</h1>
            <p class="text-sm text-gray-500 mt-1">Preencha os dados do novo usu√°rio</p>
            {% endif %}
        </div>

        <!-- Card do Formul√°rio -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">

            {% if usuario %}
            <!-- Header Editar -->
            <div class="bg-purple-600 text-white px-6 py-4">
                <h2 class="text-lg font-semibold">Editar Usu√°rio</h2>
                <p class="text-sm text-purple-100">Altere os dados do usu√°rio</p>
            </div>
            {% else %}
            <!-- Header Criar -->
            <div class="bg-blue-600 text-white px-6 py-4">
                <h2 class="text-lg font-semibold">Novo Usu√°rio</h2>
                <p class="text-sm text-blue-100">Preencha os dados do novo usu√°rio</p>
            </div>
            {% endif %}

            <form method="POST"
                action="{% if usuario %}{{ url_for('main.editar_usuario', usuario_id=usuario.id) }}{% else %}{{ url_for('main.gerenciar_usuarios') }}{% endif %}"
                class="p-6 space-y-5">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                {% if not usuario %}
                <input type="hidden" name="acao" value="criar">
                {% endif %}

                <!-- Email -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">üìß Email *</label>
                    <input type="email" name="email" required value="{{ usuario.email if usuario else '' }}"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                        placeholder="usuario@dtx.com">
                </div>

                <!-- Nome -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">üë§ Nome Completo *</label>
                    <input type="text" name="nome" required minlength="3" value="{{ usuario.nome if usuario else '' }}"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Jo√£o da Silva">
                </div>

                <!-- Perfil -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">üë• Perfil *</label>
                    <select name="perfil" id="perfilSelect" required onchange="toggleArea()"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="solicitante" {% if usuario and usuario.perfil=='solicitante' %}selected{% endif
                            %}>Solicitante (Cria chamados)</option>
                        <option value="supervisor" {% if usuario and usuario.perfil=='supervisor' %}selected{% endif %}>
                            Supervisor (Gerencia √°rea)</option>
                        <option value="admin" {% if usuario and usuario.perfil=='admin' %}selected{% endif %}>Admin
                            (Acesso total)</option>
                    </select>
                </div>

                <!-- √Åreas (vis√≠vel apenas para supervisor e admin) -->
                <div id="areaDiv" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2">üè¢ √Åreas/Setores (Selecione um ou
                        mais) *</label>
                    <div class="grid grid-cols-2 gap-2 bg-gray-50 p-3 rounded-md border border-gray-300">
                        {% set areas_usuario = usuario.areas if usuario and usuario.areas else [] %}
                        <label class="inline-flex items-center"><input type="checkbox" name="areas" value="Manutencao"
                                class="form-checkbox text-blue-600 rounded" {% if 'Manutencao' in areas_usuario
                                %}checked{% endif %}> <span class="ml-2 text-sm text-gray-700">Manuten√ß√£o</span></label>
                        <label class="inline-flex items-center"><input type="checkbox" name="areas" value="Engenharia"
                                class="form-checkbox text-blue-600 rounded" {% if 'Engenharia' in areas_usuario
                                %}checked{% endif %}> <span class="ml-2 text-sm text-gray-700">Engenharia</span></label>
                        <label class="inline-flex items-center"><input type="checkbox" name="areas" value="Qualidade"
                                class="form-checkbox text-blue-600 rounded" {% if 'Qualidade' in areas_usuario
                                %}checked{% endif %}> <span class="ml-2 text-sm text-gray-700">Qualidade</span></label>
                        <label class="inline-flex items-center"><input type="checkbox" name="areas" value="Comercial"
                                class="form-checkbox text-blue-600 rounded" {% if 'Comercial' in areas_usuario
                                %}checked{% endif %}> <span class="ml-2 text-sm text-gray-700">Comercial</span></label>
                        <label class="inline-flex items-center"><input type="checkbox" name="areas" value="Planejamento"
                                class="form-checkbox text-blue-600 rounded" {% if 'Planejamento' in areas_usuario
                                %}checked{% endif %}> <span
                                class="ml-2 text-sm text-gray-700">Planejamento</span></label>
                        <label class="inline-flex items-center"><input type="checkbox" name="areas" value="Material"
                                class="form-checkbox text-blue-600 rounded" {% if 'Material' in areas_usuario
                                %}checked{% endif %}> <span class="ml-2 text-sm text-gray-700">Material</span></label>
                    </div>
                </div>

                <!-- Senha -->
                <div>
                    {% if usuario %}
                    <label class="block text-sm font-medium text-gray-700 mb-1">üîë Nova Senha (deixe em branco para
                        manter)</label>
                    <input type="password" name="senha" minlength="6"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Deixe vazio para manter a senha atual">
                    {% else %}
                    <label class="block text-sm font-medium text-gray-700 mb-1">üîë Senha *</label>
                    <input type="password" name="senha" required minlength="6"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                        placeholder="M√≠nimo 6 caracteres">
                    {% endif %}
                </div>

                <!-- Bot√µes -->
                <div class="flex gap-3 justify-end pt-4 border-t border-gray-200">
                    <a href="{{ url_for('main.gerenciar_usuarios') }}"
                        class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium rounded-md transition">
                        Cancelar
                    </a>
                    {% if usuario %}
                    <button type="submit"
                        class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-md transition">
                        Salvar Altera√ß√µes
                    </button>
                    {% else %}
                    <button type="submit"
                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md transition">
                        Criar Usu√°rio
                    </button>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function toggleArea() {
        const perfil = document.getElementById('perfilSelect').value;
        const areaDiv = document.getElementById('areaDiv');
        if (perfil === 'solicitante') {
            areaDiv.classList.add('hidden');
        } else {
            areaDiv.classList.remove('hidden');
        }
    }
    // Executar na carga para mostrar √°reas se perfil j√° √© supervisor/admin
    toggleArea();
</script>

{% endblock %}